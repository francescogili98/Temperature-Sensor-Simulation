<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... Altri tag meta e link ... -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
    <style>
        /* Stile per la mappa */
        #mappa {
            position: absolute;
            top: 510px;
            right: 90px;
            width: 300px;
            height: 200px;
        }

        /* Stile per l'intestazione */
        #intestazione {
            text-align: center;
            font-size: 24px;
            margin-top: 20px;
        }

        /* Stile per la tabella */
        #tabella {
            position: absolute;
            bottom: 180px;
            left: 80px;
            border-collapse: collapse; /* Aggiungi bordi tra le celle */
            width: 60%; /* Imposta la larghezza della tabella */
        }

        #tabella th,
        #tabella td {
            border: 1px solid #ddd; /* Aggiungi bordi alle celle */
            padding: 8px; /* Aggiungi spazio intorno ai contenuti delle celle */
            text-align: left; /* Allinea il testo a sinistra nelle celle */
        }

        /* Aggiungi uno sfondo alternato alle righe della tabella */
        #tabella tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* Allinea l'intestazione della tabella al centro e aggiungi sfondo */
        #tabella th {
            background-color: #4CAF50;
            color: white;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Intestazione -->
    <div id="intestazione">
        SensTemp Dashboard
    </div>

    <!-- Grafico delle temperature -->
    <div id="grafico-temperatura"></div>

    <!-- Mappa -->
    <div id="mappa"></div>

    <!-- Tabella -->
    <table id="tabella">
        <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Location</th>
            <th>Temp.Value</th>
            <th>Alarm mode</th>
        </tr>
        <!-- Qui verranno aggiunte dinamicamente le righe della tabella -->
    </table>

    <script>
        var sensor = "{{ sensor }}";
        var temperatureData = {{ temperatureData|safe }};
        var orariData = {{ orariData|safe }};
        var AlarmsData = {{ AlarmsData|safe }}; // La variabile AlarmsData contiene i dati per la tabella

        // Codice per il primo grafico (andamento della temperatura) qui...
        var data = [{
            x: orariData,
            y: temperatureData,
            type: 'scatter',
            mode: 'lines+markers',
            name: 'Temperatura'
        }];

        var layout = {
            title: 'Andamento della Temperatura - ' + sensor,
            xaxis: { title: 'Orario' },
            yaxis: { title: 'Temperatura (Â°C)' }
        };

        Plotly.newPlot('grafico-temperatura', data, layout);

        // Codice per il secondo grafico (localizzazione) qui...
        var lat = {{ lat }};
        var long = {{ long }};
        var map = L.map('mappa').setView([lat, long], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        L.marker([lat, long]).addTo(map).bindPopup("<h1>Unit {{sensor}}</h1><br>");

        // Funzione per aggiornare la tabella con i dati da AlarmsData
        function updateTable() {
            var table = document.getElementById("tabella");

            // Rimuovi tutte le righe precedenti
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }

            // Aggiungi le nuove righe in base ai dati in AlarmsData
            for (var i = 0; i < AlarmsData.length; i++) {
                var rowData = AlarmsData[i];
                var row = table.insertRow(-1);
                var dateCell = row.insertCell(0);
                dateCell.innerHTML = rowData.Date;
                var timeCell = row.insertCell(1);
                timeCell.innerHTML = rowData.Time;
                var locationCell = row.insertCell(2);
                locationCell.innerHTML = rowData.Location;
                var tempValueCell = row.insertCell(3);
                tempValueCell.innerHTML = rowData.TempValue;
                var alarmModeCell = row.insertCell(4);
                alarmModeCell.innerHTML = rowData.AlarmMode;
            }
        }

        // Chiamare la funzione di aggiornamento della tabella inizialmente
        updateTable();

        // Aggiorna la tabella ogni 5 secondi (come nel tuo codice originale)
        setTimeout(function(){
            updateTable();
            window.location.reload();
        }, 5000);
    </script>
</body>
</html>








